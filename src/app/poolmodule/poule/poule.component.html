<div class="row justify-content-center g-0">
    <div class="col-xs-12 col-sm-10 col-md-8 col-lg-6">

        <div class="d-flex justify-content-between mt-2">
            <h2 class="ms-3">
                <app-superelf-icon [name]="cssService.getIconName(leagueName)"></app-superelf-icon>
                <span class="ms-1">{{nameService.getLeagueName(leagueName)}}</span>
            </h2>
            <div>
                <button *ngIf="poolPoule" (click)="navigateToChat(poolPoule)" type="button"
                    class="btn btn-outline-dark me-3 position-relative">
                    <fa-icon [icon]="['fas', 'message']"></fa-icon>
                    <span class="ms-1"> chat</span>
                    <span *ngIf="nrOfUnreadMessages > 0"
                        class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                        {{nrOfUnreadMessages}}
                        <span class="visually-hidden">ongelezen berichten</span>
                    </span>
                </button>
                <button (click)="navigateBack()" type="button" class="btn btn-outline-dark">
                    <fa-icon [icon]="['fas', 'level-up-alt']" [rotate]="270"></fa-icon>
                    <span class="ms-1 d-none d-md-inline"> terug</span>
                </button>
            </div>
        </div>

        <h2 *ngIf="processing" class="text-center">
            <fa-icon [icon]="['fas', 'spinner']" [spin]="true"></fa-icon>
        </h2>

        <div *ngIf="!processing && poolPoule && homeCompetitor && awayCompetitor">
            <h2 class="d-flex justify-content-center">
                <app-poule-title [poule]="poolPoule" [poolCompetitors]="pool.getCompetitors(leagueName)">
                </app-poule-title>
            </h2>

            <div class="d-flex justify-content-center mt-2">
                <app-gameround-scroller [gameRounds]="gameRounds" [current]="currentGameRound"
                    (update)="updateGameRound($event)">
                </app-gameround-scroller>
            </div>

            <h2 *ngIf="!processing && processingGameRound" class="text-center">
                <fa-icon [icon]="['fas', 'spinner']" [spin]="true"></fa-icon>
            </h2>
            <table class="table" *ngIf="currentGameRound && !processingGameRound">
                <thead>
                    <tr>
                        <th class="border-bottom-0"></th>
                        <th class="border-bottom-0 text-right">
                            <span *ngIf="getCurrentPoolGame(currentGameRound)?.getState() !== Created"
                                class="badge bg-totals">
                                {{getPoolGamePoints(currentGameRound, homeCompetitor)}}</span>
                        </th>
                        <th class="border-bottom-0"><span
                                *ngIf="getCurrentPoolGame(currentGameRound)?.getState() !== Created"
                                class="badge bg-totals">
                                {{getPoolGamePoints(currentGameRound, awayCompetitor)}}</span></th>
                        <th class="border-bottom-0"></th>
                    </tr>
                </thead>

                <tbody *ngFor="let sourceGame of sourceGames">
                    <tr>
                        <td colspan="4" class="border-bottom-0 pt-3 pb-0">
                            <app-againstgame-title [againstGame]="sourceGame"></app-againstgame-title>
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <ng-container [ngTemplateOutlet]="contentForamtionPlaces"
                                [ngTemplateOutletContext]="{formationPlaces:getFormationPlaces(sourceGame, homeCompetitor)}">
                            </ng-container>
                        </td>
                        <td>
                            <ng-container *ngIf="sourceGame.getState() === Finished"
                                [ngTemplateOutlet]="contentForamtionPlacesScores"
                                [ngTemplateOutletContext]="{formationPlaces:getFormationPlaces(sourceGame, homeCompetitor)}">
                            </ng-container>
                        </td>
                        <td>
                            <ng-container *ngIf="sourceGame.getState() === Finished"
                                [ngTemplateOutlet]="contentForamtionPlacesScores"
                                [ngTemplateOutletContext]="{formationPlaces:getFormationPlaces(sourceGame, awayCompetitor)}">
                            </ng-container>
                        </td>
                        <td class="text-end">
                            <ng-container [ngTemplateOutlet]="contentForamtionPlaces"
                                [ngTemplateOutletContext]="{formationPlaces:getFormationPlaces(sourceGame, awayCompetitor), away: true}">
                            </ng-container>
                        </td>
                    </tr>
                </tbody>

            </table>

            <ng-template #contentForamtionPlaces let-formationPlaces="formationPlaces" let-away="away">
                <div *ngFor="let formationPlace of formationPlaces" class="d-flex align-items-start"
                    [ngClass]="{'flex-row-reverse': away}">
                    <app-lineicon *ngIf="formationPlace.getPlayer()" [line]="formationPlace.getPlayer().getLine()">
                    </app-lineicon>
                    <ng-container [ngTemplateOutlet]="contentPlayer"
                        [ngTemplateOutletContext]="{s11Player:formationPlace.getPlayer()}">
                    </ng-container>
                    <span *ngIf="formationPlace.isSubstitute()" class="badge badge-reserve">r</span>
                </div>
            </ng-template>

            <ng-template #contentForamtionPlacesScores let-formationPlaces="formationPlaces">
                <div *ngFor="let formationPlace of formationPlaces">
                    <ng-container *ngIf="formationPlace.hasAppeared();else startingNotAppeared">
                        <span class="badge bg-points">
                            {{formationPlace.getPoints(currentGameRound)}}</span>
                    </ng-container>
                    <ng-template #startingNotAppeared>
                        <span class="badge bg-nopoints">x</span>
                    </ng-template>
                </div>
            </ng-template>

            <ng-template #contentPlayer let-s11Player="s11Player">
                <span class="mx-1 text-break" *ngIf="s11Player">{{s11Player.getPerson().getName()}}</span>
            </ng-template>
        </div>
    </div>
</div>